var rave=rave||function(){function f(){if("undefined"==typeof OpenAjax)throw"No implementation of OpenAjax found.  Please ensure that an implementation has been included in the page.";return new OpenAjax.hub.ManagedHub({onSubscribe:function(a,d){b((null==d?"Container":d.getClientID())+" subscribes to this topic '"+a+"'");return!0},onUnsubscribe:function(a,d){b((null==d?"Container":d.getClientID())+" unsubscribes from this topic '"+a+"'");return!0},onPublish:function(a,d,c,g){b((null==c?"Container":
c.getClientID())+" publishes '"+d+"' to topic '"+a+"' subscribed by "+(null==g?"Container":g.getClientID()));return!0}})}function n(a){a=a.split("-");return 2<a.length&&"widget"==a[0]||"region"==a[0]?a[1]:null}function l(a,b){$("#widget-"+a+"-body").html(b)}function e(a){return"function"==typeof a}function b(a){"undefined"!=typeof console&&console.log&&console.log(a)}var a={},c={},k={},o="",j={},g,m=[],d=[],i=[],p=[],h=function(){function a(r){return"widget-"+r+"-prefs-content"}function b(a,d){m();
var c=s();c.addClass("regionDragging");c.removeClass("regionNonDragging");q.widget=d.item.children(".widget").get(0);q.currentRegion=d.item.parent().get(0);$(".widget").each(function(a,r){var b=$(r),d=$("<div></div>"),c={position:"absolute",height:b.height(),width:b.width(),"z-index":10,opacity:0.7,background:"#FFFFFF"};$(d).css(c);$(d).addClass("dnd-overlay");b.prepend(d[0])})}function d(a,b){var c=s();$(".widgetRow").length&&c.find(".widgetRow").each(k);c.removeClass("regionDragging");c.addClass("regionNonDragging");
$(".dnd-overlay").remove();b.item.attr("style","");q.targetRegion=b.item.parent().get(0);q.targetIndex=b.item.index();rave.api.rpc.moveWidget(q);q.currentRegion=null;q.targetRegion=null;q.targetIndex=null;q.widget=null}function g(){m()}function m(){$(".upperRow").length&&$(".regions").find(".upperRow").each(h);if($(".bottomRow").length){var a=$(".regions").find(".bottomRow");k(a);var b=$("body").outerHeight(),d=$(window).height();if(d>=b){var c=$("#pageContent").outerHeight(),b=b-c,c=0;if($(".upperRow").length)for(var g=
$(".regions").find(".upperRow"),i=0;i<g.length;i++)var t=j(g.get(i)),c=c+t;f(a,d-50-(c+b))}else h(a);s().sortable("refreshPositions")}}function h(a){a="number"===typeof a?$(this):a;k(a);f(a,j(a));s().sortable("refreshPositions")}function j(a){for(var a=$(a).children(),b=100,d=0;d<a.length;d++)$(a.get(d)).outerHeight()>b&&(b=$(a.get(d)).outerHeight());return b}function k(a){for(var a="number"===typeof a?$(this):a,a=$(a).children(),b=0;b<a.length;b++)$(a.get(b)).css("padding-bottom",5)}function f(a,
b){for(var d=$(a).children(),c=0;c<d.length;c++)if($(d.get(c)).outerHeight()!=b){var g=parseInt($(d.get(c)).css("padding-bottom").replace("px",""));$(d.get(c)).css("padding-bottom",g+b-$(d.get(c)).outerHeight())}}function p(){$(".widget-wrapper").each(function(){var a=n($(this).attr("id"));H(a)})}function l(a){var b=a.data.id,a=c[b],d=!a.collapsed,b={regionWidgetId:b,collapsed:d};"undefined"!=typeof a&&(d&&e(a.collapse)?b.successCallback=a.collapse:!d&&e(a.restore)&&(b.successCallback=a.restore));
rave.isMobile()||!rave.isPageEditor()?rave.doWidgetUiCollapse(b):rave.api.rest.saveWidgetCollapsedState(b)}function o(a){var b=!0,a=$(a);a.hasClass(B)&&(b=0<$.trim(a.val()).length);return b}function I(b){var b=c[b.data.id],d=$("#"+a(b.regionWidgetId)),g={},i=!1;d.find("*").filter(":input").each(function(a,b){switch(b.type){case "text":o(b)?(g[b.name]=$(b).val(),$(b).removeClass(u)):(i=!0,$(b).addClass(u));break;case "select-one":case "hidden":g[b.name]=$(b).val();break;case "checkbox":g[b.name]=$(b).is(":checked").toString();
break;case "textarea":if(o(b)){for(var d=[],c=$(b).val().split("\n"),r=0;r<c.length;r++){var t=$.trim(c[r]);0<t.length&&d.push(t)}g[b.name]=d.join("|");$(b).removeClass(u)}else i=!0,$(b).addClass(u)}});i?d.find("."+u).first().focus():(e(b.savePreferences)&&b.savePreferences(g),d.html(""),d.hide())}function J(b){b=$("#"+a(b.data.id));b.html("");b.hide()}function C(a){var b=$("#pageContent"),d=$("<div></div>"),c={height:$("body").height()-40};$(d).css(c);$(d).addClass("canvas-overlay");b.prepend(d[0]);
s().sortable("option","disabled",!0);$("#widget-"+a+"-wrapper").removeClass("widget-wrapper").addClass("widget-wrapper-canvas");$("#widget-"+a+"-widget-menu-wrapper").hide();$("#widget-"+a+"-min").show();$("#widget-"+a+"-collapse").hide()}function H(a){var b=rave.getRegionWidgetById(a);$("#widget-"+a+"-min").click({id:a},rave.minimizeWidget);var d=$("#widget-"+a+"-collapse");d.html(b.collapsed?D:E);d.click({id:a},l).mousedown(function(a){a.stopPropagation()});$("#widget-"+a+"-toolbar").mousedown(function(a){a.stopPropagation()})}
function s(){return $(".region:not(.region-locked)")}var v=/{name}/g,w=/{value}/g,K=/{options}/g,L=/{selected}/g,M=/{checked}/g,N=/{displayValue}/g,O=/\|/g,F=/{elementId}/g,x=/{prefLabelTemplate}/g,y=/{class}/g,G=/{buttonText}/g,D='<i class="icon-chevron-down"></i>',E='<i class="icon-chevron-up"></i>',B="widget-prefs-input-required",u="widget-prefs-input-failed-validation",z={sidebar:{name:"sidebar",containerSelector:".popup.slideout",contentSelector:".slideout-content",markup:'<div class="popup slideout"><div class="slideout-content"></div></div>',
initialize:function(a){a.find(this.contentSelector).data("popupType",this.name);a.show("slide",{direction:"right"},"fast");$("body").addClass("modal-open");$("body").append('<div class="modal-backdrop fade in"></div>')},cleanup:function(a){var b=a.parents(this.containerSelector);b.hide("slide",{direction:"right"},"fast",function(){b.detach();$("body").removeClass("modal-open");$(".modal-backdrop").remove()})},singleton:!0},dialog:{name:"dialog",containerSelector:".popup.dialog",contentSelector:".modal-body",
markup:'<div class="popup dialog modal fade"><div class="modal-body"></div></div>',initialize:function(a){a.find(this.contentSelector).data("popupType",this.name);a.modal({});a.on("hidden",function(){a.detach()})},cleanup:function(a){a.parents(this.containerSelector).modal("hide")},singleton:!1},modal_dialog:{name:"modal_dialog",containerSelector:".popup.modal_dialog",contentSelector:".modal-body",markup:'<div class="popup modal_dialog modal fade"><div class="modal-body"></div></div>',initialize:function(a){a.find(this.contentSelector).data("popupType",
this.name);a.modal({keyboard:!1,backdrop:"static",show:!0});a.on("hidden",function(){a.detach()})},cleanup:function(a){a.parents(this.containerSelector).modal("hide")},singleton:!0},"float":!1,tab:!1},q={widget:null,currentRegion:null,targetRegion:null,targetIndex:null};return{init:function(){s().sortable({connectWith:".region",scroll:!0,opacity:0.5,revert:!0,cursor:"move",handle:".widget-title-bar",forcePlaceholderSize:!0,tolerance:"pointer",start:b,stop:d,over:g});p();if(null!==i&&0<i.length)for(var a=
0,c=i.length;a<c;++a)try{i[a]()}catch(t){gadgets.warn("Could not fire onUIInitializedHandler "+t.message)}i=null},initMobile:function(){$(".widget-wrapper").each(function(){var a=n($(this).attr("id"));rave.getRegionWidgetById(a);$(this).find(".widget-title-bar-mobile").click({id:a},l)})},toggleCollapseWidgetIcon:function(a,b){var d=$("#widget-"+a+"-collapse");b?d.html(D):d.html(E)},maximizeAction:function(a,b){var d=a.data.id;C(d);d=rave.getRegionWidgetById(d);"undefined"!=typeof d&&e(d.maximize)&&
d.maximize(b,a.data.view)},minimizeAction:function(a,b){var d=a.data.id;$(".dnd-overlay, .canvas-overlay").remove();s().sortable("option","disabled",!1);$("#widget-"+d+"-wrapper").removeClass("widget-wrapper-canvas").addClass("widget-wrapper");$("#widget-"+d+"-min").hide();$("#widget-"+d+"-widget-menu-wrapper").show();$("#widget-"+d+"-collapse").show();d=rave.getRegionWidgetById(d);"undefined"!=typeof d&&(d.collapsed&&e(d.collapse)?d.collapse():e(d.minimize)&&d.minimize(b,a.data.view))},createPopup:function(a){a=
z[a.toLowerCase()];if(!a)return rave.log("The popup view requested is not implemented by rave");if(a.singleton&&0<$(a.containerSelector).length)return $(a.contentSelector).get(0);var b=$(a.markup);$("#pageContent").prepend(b);"function"==$.type(a.initialize)&&a.initialize(b);return b.find(a.contentSelector).get(0)},destroyPopup:function(a){var a=$(a),b=z[a.data("popupType")];if(!b)return rave.log("Rave has detected a destroy request for a popup whose type cannot be detected."),a.detach();"function"==
$.type(b.cleanup)&&b.cleanup(a)},editPrefsAction:function(b){var b=c[b],d=b.metadata.userPrefs,g=!1,i=[];i.push("<table>");for(var m in d){var h=d[m],j=b.userPrefs[h.name],k;k=h;var e=[],f=k.required?"* "+k.displayName:k.displayName;e.push("<td class='");e.push("widget-prefs-label");k.required&&(e.push(" "),e.push("widget-prefs-label-required"));e.push("'>");e.push(f);e.push("</td>");k=e.join("");e=h;f=[];f.push("widget-prefs-input");e.required&&(f.push(" "),f.push(B));e=f.join("");h.required&&(g=
!0);switch(h.dataType){case "STRING":i.push("<tr>{prefLabelTemplate}<td><input type='text' id='{name}' name='{name}' value='{value}' class='{class}'></td></tr>".replace(x,k).replace(y,e).replace(v,h.name).replace(w,"undefined"!=typeof j?j:h.defaultValue));break;case "BOOL":j="undefined"!=typeof j?"true"===j||!0===j:"true"===h.defaultValue||!0===h.defaultValue;i.push("<tr>{prefLabelTemplate}<td><input type='checkbox' id='{name}' name='{name}' class='{class}' {checked}></td></tr>".replace(x,k).replace(y,
e).replace(v,h.name).replace(M,j?"checked":""));break;case "ENUM":for(var f=[],p=0;p<h.orderedEnumValues.length;p++){var l=h.orderedEnumValues[p],o=j==l.value||"undefined"==typeof j&&l.value==h.defaultValue;f.push("<option value='{value}' {selected}>{displayValue}</option>".replace(w,l.value).replace(N,l.displayValue).replace(L,o?"selected":""))}i.push("<tr>{prefLabelTemplate}<td><select id='{name}' name='{name}' class='{class}'>{options}</select></td></tr>".replace(x,k).replace(y,e).replace(v,h.name).replace(K,
f.join("")));break;case "LIST":j="undefined"!=typeof j?j:h.defaultValue;j=j.replace(O,"\n");i.push("<tr>{prefLabelTemplate}<td><textarea id='{name}' name='{name}' rows='5' cols='12' class='{class}'>{value}</textarea></td></tr>".replace(x,k).replace(y,e).replace(v,h.name).replace(w,j));break;default:i.push("<input type='hidden' id='{name}' name='{name}' value='{value}'>".replace(v,h.name).replace(w,"undefined"!=typeof j?j:h.defaultValue))}}g&&i.push("<tr><td colspan='2' class='widget-prefs-required-text'>"+
rave.getClientMessage("widget.prefs.required.title")+"</td></tr>");i.push("<tr><td colspan='2'>");i.push("<button type='button' id='{elementId}'>{buttonText}</button>".replace(F,"widget-"+b.regionWidgetId+"-prefs-save-button").replace(G,rave.getClientMessage("common.save")));i.push("<button type='button' id='{elementId}'>{buttonText}</button>".replace(F,"widget-"+b.regionWidgetId+"-prefs-cancel-button").replace(G,rave.getClientMessage("common.cancel")));i.push("</td></tr>");i.push("</table>");m=$("#"+
a(b.regionWidgetId));m.html(i.join(""));$("#"+("widget-"+b.regionWidgetId+"-prefs-save-button")).click({id:b.regionWidgetId},I);$("#"+("widget-"+b.regionWidgetId+"-prefs-cancel-button")).click({id:b.regionWidgetId},J);m.show()},editCustomPrefsAction:function(a){a=a.data.id;C(a);a=rave.getRegionWidgetById(a);"undefined"!=typeof a&&a.editCustomPrefs()},setMobileState:function(a){this.mobileState=a},getMobileState:function(){return this.mobileState},doWidgetUiCollapse:function(a){rave.getRegionWidgetById(a.regionWidgetId).collapsed=
a.collapsed;rave.toggleCollapseWidgetIcon(a.regionWidgetId,a.collapsed);"function"==typeof a.successCallback&&a.successCallback()},toggleMobileWidget:function(a){var b={data:{}};b.data.id=a;l(b)},displayEmptyPageMessage:function(){$("#emptyPageMessageWrapper").removeClass("hidden")},displayUsersOfWidget:function(a){rave.api.rest.getUsersForWidget({widgetId:a,successCallback:function(b){for(var d="<ul class='widget-users'>",c=0;c<b.length;c++)var g=b[c],d=d+("<li class='widget-user'>"+(g.displayName?
g.displayName:(g.preferredName?g.preferredName:g.givenName)+" "+g.familyName)+"</li>");$("<div class='dialog widget-users-dialog' title='"+$("#widget-"+a+"-title").text().trim()+" "+rave.getClientMessage("widget.users.added_by")+"'>"+(d+"</ul>")+"</div>").dialog({modal:!0,buttons:[{text:"Close",click:function(){$(this).dialog("close")}}]})}})},showInfoMessage:function(a){$("<div />",{"class":"alert alert-success navbar-spacer",text:a}).hide().prependTo("body").css({position:"fixed",bottom:"0px",margin:"0 0.5%",
width:"95%",padding:"8px 2%","z-index":9999,"border-radius":"4px 4px 0 0"}).fadeIn("fast").delay(5E3).fadeOut(function(){$(this).remove()})},registerPopup:function(a,b){z[a]=b}}}();return{registerWidget:function(a,b){k.hasOwnProperty(a)||(k[a]=[]);k[a].push(b)},initProviders:function(){for(var b in a)a[b].init();if(null!==d&&0<d.length){b=0;for(var c=d.length;b<c;++b)try{d[b]()}catch(g){gadgets.warn("Could not fire onProvidersInitializedHandler "+g.message)}}d=null},initWidgets:function(){for(var b=
[],d,g=0;;g++){var i=!1,h;for(h in k)h=k[h],h.length>g&&(i=!0,d=h[g],rave.isMobile()&&(d.collapsed=!0),b.push(d));if(!i)break}if(0==b.length)rave.displayEmptyPageMessage();else for(d=0;d<b.length;d++)g=b[d],i=g,"DISABLED"==i.type?(h=unescape(i.disabledMessage),$("#widget-"+i.regionWidgetId+"-body").html(h)):(h=a[i.type],"undefined"==typeof h?l(i.regionWidgetId,rave.getClientMessage("widget.provider.error")):h.initWidget(i)),c[g.regionWidgetId]=g;if(null!==m&&0<m.length){g=0;for(d=m.length;g<d;++g)try{m[g]()}catch(j){gadgets.warn("Could not fire onWidgetInitializedHandler "+
j.message)}}m=null},initUI:h.init,initMobileUI:h.initMobile,getObjectIdFromDomId:n,registerProvider:function(b){if(b.hasOwnProperty("init"))a[b.TYPE]=b;else throw"Attempted to register invalid provider";},errorWidget:l,setContext:function(a){o=a},getContext:function(){return o},getRegionWidgetById:function(a){return c[a]},viewPage:function(a){window.location.href=rave.getContext()+"page/view"+(null!=a?"/"+a:"")},viewWidgetDetail:function(a,b){window.location.href=rave.getContext()+"store/widget/"+
a+"?referringPageId="+b},toggleCollapseWidgetIcon:h.toggleCollapseWidgetIcon,isFunction:e,maximizeWidget:h.maximizeAction,minimizeWidget:h.minimizeAction,createPopup:h.createPopup,destroyPopup:h.destroyPopup,editPrefs:h.editPrefsAction,editCustomPrefs:h.editCustomPrefsAction,isMobile:h.getMobileState,setMobile:h.setMobileState,doWidgetUiCollapse:h.doWidgetUiCollapse,toggleMobileWidget:h.toggleMobileWidget,isPageEmpty:function(){return $.isEmptyObject(c)},removeWidgetFromMap:function(a){delete c[a]},
displayEmptyPageMessage:h.displayEmptyPageMessage,displayUsersOfWidget:h.displayUsersOfWidget,showInfoMessage:h.showInfoMessage,getClientMessage:function(a){return j[a]},addClientMessage:function(a,b){return j[a]=b},getManagedHub:function(){if("undefined"==typeof g||null==g)g=f();return g},resetManagedHub:function(){g=null},log:b,getWidgetsByRegionIdMap:function(){return k},clearWidgetsByRegionIdMap:function(){k={}},registerPopup:h.registerPopup,initPageEditorStatus:function(a){"undefined"!=a&&(this.pageEditor=
a)},isPageEditor:function(){return this.pageEditor},registerOnWidgetsInitizalizedHandler:function(a){null!==m?m.push(a):a()},registerOnProvidersInitizalizedHandler:function(a){null!==d?d.push(a):a()},registerOnUIInitizalizedHandler:function(a){null!==i?i.push(a):a()},registerOnPageInitizalizedHandler:function(a){null!==p?p.push(a):a()},runOnPageInitializedHandlers:function(){if(null!==p&&0<p.length)for(var a=0,b=p.length;a<b;++a)try{p[a]()}catch(d){gadgets.warn("Could not fire onPageInitializedHandler "+
d.message)}p=null}}}(),rave=rave||{};
rave.admin=rave.admin||function(){return{initAdminUi:function(){function f(){$(".datatable tr").bind("click",function(){var f=$(this).attr("data-detaillink");void 0!=f&&""!=f&&(window.location=f)})}function n(){$("#thumbnailModal, #screenshotModal").on("shown",function(){if(!$(this).hasClass("sized")){var f=$(this).find("img").width(),e=$(this).find("img").height(),b=$(this).find(".modal-footer").outerHeight(),a=$(this).find(".modal-header").outerHeight(),e=e+b+a;$(this).css({width:f+"px","margin-top":"-"+
Math.round(e/2)+"px","margin-left":"-"+Math.round(f/2)+"px"}).addClass("sized")}})}return{init:function(){f();n()}}}().init}}();rave=rave||{};
rave.api=rave.api||function(){function f(b,a,c){alert(rave.getClientMessage("api.error")+c)}var n=function(){return{updateWidgetRating:function(b){$.ajax({type:"POST",url:rave.getContext()+"api/rest/widgets/"+b.widgetId+"/rating?score="+b.score,success:function(){"function"==typeof b.successCallback&&b.successCallback()},error:f})},deleteWidgetRating:function(b){$.ajax({type:"DELETE",url:rave.getContext()+"api/rest/widgets/"+b.widgetId+"/rating",success:function(){"function"==typeof b.successCallback&&
b.successCallback()},error:f})},saveWidgetPreferences:function(b){var a={preferences:[]},c;for(c in b.userPrefs)a.preferences.push({name:c,value:b.userPrefs[c]});$.ajax({type:"PUT",url:rave.getContext()+"api/rest/regionWidgets/"+b.regionWidgetId+"/preferences",data:JSON.stringify(a),contentType:"application/json",dataType:"json",success:function(){"function"==typeof b.successCallback&&b.successCallback()},error:f})},saveWidgetPreference:function(b){$.ajax({type:"PUT",url:rave.getContext()+"api/rest/regionWidgets/"+
b.regionWidgetId+"/preferences/"+b.userPref.prefName,data:JSON.stringify({name:b.userPref.prefName,value:b.userPref.prefValue}),contentType:"application/json",dataType:"json",success:function(){"function"==typeof b.successCallback&&b.successCallback()},error:f})},saveWidgetCollapsedState:function(b){$.ajax({type:"PUT",url:rave.getContext()+"api/rest/regionWidgets/"+b.regionWidgetId+"/collapsed",data:JSON.stringify(b.collapsed),contentType:"application/json",dataType:"json",success:function(a){rave.doWidgetUiCollapse({regionWidgetId:a.id,
collapsed:a.collapsed,successCallback:b.successCallback})},error:f})},createWidgetComment:function(b){$.ajax({type:"POST",url:rave.getContext()+"api/rest/widgets/"+b.widgetId+"/comments?text="+escape(b.text),success:function(){"function"==typeof b.successCallback&&b.successCallback()},error:f})},updateWidgetComment:function(b){$.ajax({type:"POST",url:rave.getContext()+"api/rest/widgets/"+b.widgetId+"/comments/"+b.commentId+"?text="+escape(b.text),success:function(){"function"==typeof b.successCallback&&
b.successCallback()},error:f})},deleteWidgetComment:function(b){$.ajax({type:"DELETE",url:rave.getContext()+"api/rest/widgets/"+b.widgetId+"/comments/"+b.commentId,success:function(){"function"==typeof b.successCallback&&b.successCallback()},error:f})},deletePage:function(b){$.ajax({type:"DELETE",url:rave.getContext()+"api/rest/page/"+b.pageId,success:function(){"function"==typeof b.successCallback&&b.successCallback()},error:f})},getUsersForWidget:function(b){$.ajax({type:"GET",url:rave.getContext()+
"api/rest/widgets/"+b.widgetId+"/users",success:function(a){"function"==typeof b.successCallback&&b.successCallback(a)},error:f})},createWidgetTag:function(b){$.ajax({type:"POST",url:rave.getContext()+"api/rest/widgets/"+b.widgetId+"/tags?tagText="+escape(b.text),success:function(){"function"==typeof b.successCallback&&b.successCallback()},error:f})},getTags:function(b){$.ajax({type:"GET",url:rave.getContext()+"api/rest/widgets/"+b.widgetId+"/tags",dataType:"json",success:function(a){"function"==
typeof b.successCallback&&b.successCallback(a)}})}}}(),l=function(){function b(a){switch(a.errorCode){case "INVALID_PARAMS":alert(rave.getClientMessage("api.rpc.error.invalid_params"));break;case "INTERNAL_ERROR":alert(rave.getClientMessage("api.rpc.error.internal"))}}return{moveWidget:function(a){var c=rave.getObjectIdFromDomId(a.widget.id),e=rave.getObjectIdFromDomId(a.targetRegion.id),o=rave.getObjectIdFromDomId(a.currentRegion.id);$.post(rave.getContext()+"api/rpc/page/regionWidget/"+c+"/move",
{newPosition:a.targetIndex,toRegion:e,fromRegion:o},function(a){a.error&&b(a)}).error(f)},addWidgetToPage:function(a){$.post(rave.getContext()+"api/rpc/page/"+a.pageId+"/widget/add",{widgetId:a.widgetId},function(a){if(a.error)b(a);else{var e=rave.getClientMessage("widget.add_prefix"),a=void 0!=a.result?a.result.widget:void 0;void 0!=a&&void 0!=a.title&&0<a.title.length&&(e=a.title);rave.showInfoMessage(e+" "+rave.getClientMessage("widget.add_suffix"))}}).error(f)},removeWidget:function(a){$.post(rave.getContext()+
"api/rpc/page/regionWidget/"+a.regionWidgetId+"/delete",null,function(c){c.error?b(c):"function"==typeof a.successCallback&&a.successCallback()}).error(f)},addPage:function(a){$.post(rave.getContext()+"api/rpc/page/add",{pageName:a.pageName,pageLayoutCode:a.pageLayoutCode},function(c){c.error?"DUPLICATE_ITEM"==c.errorCode?$("#pageFormErrors").html(rave.getClientMessage("page.duplicate_name")):b(c):"function"==typeof a.successCallback&&a.successCallback(c)}).error(f)},updatePagePrefs:function(a){$.post(rave.getContext()+
"api/rpc/page/"+a.pageId+"/update",{name:a.title,layout:a.layout},function(c){c.error?b(c):"function"==typeof a.successCallback&&a.successCallback(c)}).error(f)},getPagePrefs:function(a){$.get(rave.getContext()+"api/rpc/page/get?pageId="+a.pageId,null,function(b){"function"==typeof a.successCallback&&a.successCallback(b)})},movePage:function(a){var c={};a.moveAfterPageId&&(c.moveAfterPageId=a.moveAfterPageId);$.post(rave.getContext()+"api/rpc/page/"+a.pageId+"/move",c,function(c){c.error?b(c):typeof a.successCallback==
"function"&&a.successCallback(c)}).error(f)},moveWidgetToPage:function(a){var c={};a.toPageId&&(c.toPageId=a.toPageId,c.regionWidgetId=a.regionWidgetId);$.post(rave.getContext()+"api/rpc/page/"+a.toPageId+"/moveWidget",c,function(c){c.error?b(c):typeof a.successCallback=="function"&&a.successCallback(c)}).error(f)},getWidgetMetadata:function(a){var b=a.url,e=a.providerType;null==b||null==e?alert(rave.getClientMessage("api.widget_metadata.invalid_params")):$.post(rave.getContext()+"api/rpc/widget/metadata/get",
{url:b,type:e},function(b){b.error?alert(rave.getClientMessage("api.widget_metadata.parse_error")):"function"==typeof a.successCallback&&a.successCallback(b)}).error(f)},getWidgetMetadataGroup:function(a){var b=a.url,e=a.providerType;null==b||null==e?alert(rave.getClientMessage("api.widget_metadata.invalid_params")):$.post(rave.getContext()+"api/rpc/widget/metadatagroup/get",{url:b,type:e},function(b){b.error?alert(rave.getClientMessage("api.widget_metadata.parse_error")):"function"==typeof a.successCallback&&
a.successCallback(b)}).error(f)},getUsers:function(a){var c=a.offset;$.get(rave.getContext()+"api/rpc/users/get",{offset:c},function(c){c.error?b(c):"function"==typeof a.successCallback&&a.successCallback(c)}).error(f)},searchUsers:function(a){var c=a.searchTerm,e=a.offset;null==c||""==c?alert(rave.getClientMessage("api.rpc.empty.search.term")):$.get(rave.getContext()+"api/rpc/users/search",{searchTerm:c,offset:e},function(c){c.error?b(c):"function"==typeof a.successCallback&&a.successCallback(c)}).error(f)},
addMemberToPage:function(a){$.post(rave.getContext()+"api/rpc/page/"+a.pageId+"/addmember",{userId:a.userId},function(c){c.error?b(c):"function"==typeof a.successCallback&&a.successCallback(c)}).error(f)},removeMemberFromPage:function(a){$.post(rave.getContext()+"api/rpc/page/"+a.pageId+"/removemember",{userId:a.userId},function(c){c.error?b(c):"function"==typeof a.successCallback&&a.successCallback(c)}).error(f)},updateSharedPageStatus:function(a){$.post(rave.getContext()+"api/rpc/page/"+a.pageId+
"/sharestatus",{shareStatus:a.shareStatus},function(c){c.error?b(c):"function"==typeof a.successCallback&&a.successCallback(c)}).error(f)},updatePageEditingStatus:function(a){$.post(rave.getContext()+"api/rpc/page/"+a.pageId+"/editstatus",{userId:a.userId,isEditor:a.isEditor},function(c){c.error?b(c):"function"==typeof a.successCallback&&a.successCallback(c)}).error(f)}}}(),e=function(){return{widgetRatingHandler:function(b){var a=document.getElementById("totalLikes-"+b.widgetId),c=a.getAttribute("data-rave-widget-likes"),
e=document.getElementById("totalDislikes-"+b.widgetId),f=e.getAttribute("data-rave-widget-dislikes"),j=-1,g=-1,m="",d="",i=-1;b.isLike?(j=c,incrementingTotalLabel=a,g=f,decrementingTotalLabel=e,m=b.widgetLikeButton,d=b.widgetDislikeButton,i=0):(j=f,incrementingTotalLabel=e,g=c,decrementingTotalLabel=a,m=b.widgetDislikeButton,d=b.widgetLikeButton,i=10);j=parseInt(j)+1;incrementingTotalLabel==a?incrementingTotalLabel.setAttribute("data-rave-widget-likes",j):incrementingTotalLabel.setAttribute("data-rave-widget-dislikes",
j);incrementingTotalLabel.innerHTML=j;c=document.getElementById("rate-"+b.widgetId);e=c.value;if("true"==d.get(0).getAttribute("checked")||!0==m.checked)d.get(0).setAttribute("checked","false"),parseInt(e)==i&&-1<parseInt(g)-1&&(g=parseInt(g)-1,decrementingTotalLabel==a?decrementingTotalLabel.setAttribute("data-rave-widget-likes",g):decrementingTotalLabel.setAttribute("data-rave-widget-dislikes",g),decrementingTotalLabel.innerHTML=g);m.setAttribute("checked","true");c.value=b.isLike?"10":"0"},userProfileTabHandler:function(b){b=
"#"+b.id.substring(0,b.id.indexOf("Tab"))+"Panel";$(b).slideToggle("slow")},userProfileTagHandler:function(b,a){$(".profile-tag-page").hide();null!=a?$(a).show():$("#"+b.id+"Page").show()},userProfileEditHandler:function(b){var a=document.getElementById("profileInfo"),c="."+a.value+"-hidden",a="."+a.value+"-visible";b?($(c).show(),$(a).hide()):($(c).hide(),$(a).show())}}}();return{rest:n,rpc:l,handler:e}}();rave=rave||{};
rave.forms=rave.forms||function(){return{validateNewAccountForm:function(){$("#newAccountForm").validate({rules:{username:{required:!0,minlength:2},password:{required:!0,minlength:4},confirmPassword:{required:!0,minlength:4,equalTo:"#passwordField"},email:{required:!0}},messages:{confirmPassword:{equalTo:rave.getClientMessage("form.password.invalid_match")}}})},validateUserProfileForm:function(){$("#userProfileForm").validate({rules:{password:{required:!0,minlength:4},passwordConfirm:{required:!0,
minlength:4,equalTo:"#passwordField"}},messages:{passwordConfirm:{equalTo:rave.getClientMessage("form.password.invalid_match")}}})},validatePageForm:function(){$("#pageForm").validate({rules:{tab_title:{required:!0}}})}}}();rave=rave||{};
rave.layout=rave.layout||function(){function f(){return $("#currentPageId").val()}var n=$("#movePageDialog"),l=$("#pageForm"),e=$("#tab_title"),b=$("#tab_id"),a=$("#pageLayout"),c=function(){var c=$("#addPageButton"),g=$("#pageMenuEdit"),m=$("#pageMenuDelete"),d=$("#pageMenuMove"),i=$("#pageMenuShare"),p=$("#pageMenuRevokeShare");return{init:function(){l.validate({errorElement:"span",errorClass:"help-inline",highlight:function(a){$(a).parent().parent().addClass("error")},unhighlight:function(a){$(a).parent().parent().removeClass("error")}});
$("#pageMenuCloseButton").click(rave.layout.closePageDialog);c.bind("click",function(){$("#pageMenuDialogHeader").html(rave.getClientMessage("page.add"));var a=$("#pageMenuUpdateButton");a.html(rave.getClientMessage("common.add"));a.unbind("click");a.click(rave.layout.addPage);$("#pageMenuDialog").modal("show")});g.bind("click",function(){rave.api.rpc.getPagePrefs({pageId:f(),successCallback:function(d){e.val(d.result.name);b.val(d.result.id);a.val(d.result.pageLayout.code);$("#pageMenuDialogHeader").html(rave.getClientMessage("page.update"));
d=$("#pageMenuUpdateButton");d.html(rave.getClientMessage("common.save"));d.unbind("click");d.click(rave.layout.updatePage);$("#pageMenuDialog").modal("show")}})});m.hasClass("menu-item-disabled")||m.bind("click",function(){rave.api.rest.deletePage({pageId:f(),successCallback:rave.viewPage})});d.hasClass("menu-item-disabled")||d.bind("click",function(){n.modal("show")});i.hasClass("menu-item-disabled")||i.bind("click",function(){rave.api.rpc.getUsers({offset:0,successCallback:function(a){rave.layout.searchHandler.dealWithUserResults(a);
$("#sharePageDialog").modal("show")}})});p.hasClass("menu-item-disabled")||p.bind("click",function(){rave.layout.searchHandler.removeMemberFromPage(rave.layout.searchHandler.userId,rave.layout.searchHandler.username)})}}}(),k=function(){function a(){$("#confirmSharePageDialog").modal("show")}function b(a,c){for(var g=0;g<c.length;g++)a=a.replace("{"+g+"}",c[g]);return a}function c(a){var b=$("#shareSearchListPaging");b.empty();if(a.result.pageSize<a.result.totalResults){b.append('<div class="pagination"><ul id="pagingul" >');
1<a.result.currentPage&&(offset=(a.result.currentPage-2)*a.result.pageSize,$("#pagingul").append('<li><a href="#" onclick="rave.api.rpc.getUsers({offset: '+offset+', successCallback: function(result) {rave.layout.searchHandler.dealWithUserResults(result);}});">&lt;</a></li>'));for(var g=1;g<=a.result.numberOfPages;g++)g==a.result.currentPage?$("#pagingul").append('<li class="active"><a href="#">'+g+"</a></li>"):(offset=(g-1)*a.result.pageSize,$("#pagingul").append('<li><a href="#" onclick="rave.api.rpc.getUsers({offset: '+
offset+', successCallback: function(result) {rave.layout.searchHandler.dealWithUserResults(result);}});">'+g+"</a></li>"));a.result.currentPage<a.result.numberOfPages&&(offset=a.result.currentPage*a.result.pageSize,$("#pagingul").append('<li><a href="#" onclick="rave.api.rpc.getUsers({offset: '+offset+', successCallback: function(result) {rave.layout.searchHandler.dealWithUserResults(result);}});">&gt;</a></li>'));b.append("</ul></div>")}}return{init:function(){$("#shareSearchButton").click(function(){$("#shareSearchResults").empty();
rave.api.rpc.searchUsers({searchTerm:$("#searchTerm").get(0).value,offset:0,successCallback:function(a){rave.layout.searchHandler.dealWithUserResults(a)}})});$("#clearSearchButton").click(function(){$("#searchTerm").get(0).value="";$("#shareSearchResults").empty();rave.api.rpc.getUsers({offset:0,successCallback:function(a){rave.layout.searchHandler.dealWithUserResults(a)}})})},dealWithUserResults:function(a){var i=$("#searchTerm").get(0).value;void 0==i||""==i?$("#clearSearchButton").hide():$("#clearSearchButton").show();
i=1>a.result.resultSet.length?rave.getClientMessage("no.results.found"):b(rave.getClientMessage("search.list.result.x.to.y"),[a.result.offset+1,a.result.resultSet.length+a.result.offset,a.result.totalResults]);$("#shareSearchListHeader").text(i);i=$("#shareSearchResults");i.empty();c(a);i.append($("<table/>").addClass("searchdialogcontent").append($("<tr/>").append($("<td/>").addClass("textcell").append($("<b/>").text(rave.getClientMessage("common.username")))).append($("<td/>").addClass("booleancell").append($("<b/>").text(rave.getClientMessage("common.sharing")))).append($("<td/>").addClass("booleancell").append($("<b/>").text(rave.getClientMessage("common.editing.auth"))))).append($("<tbody/>").attr("id",
"searchResultsBody")));jQuery.each(a.result.resultSet,function(){$("#searchResultsBody").append($("<tr/>").attr("id","searchResultRecord").append($("<td/>").text(this.username)).append($("<td/>").attr("id","shareButtonHolder"+this.id)).append($("<td/>").attr("id","pageEditorStatusHolder"+this.id)));this.username!=rave.layout.searchHandler.username&&(rave.layout.searchHandler.isUserAlreadyAdded(this.username)?($("#shareButtonHolder"+this.id).append($("<a/>").attr("href","#").attr("id",this.id).attr("onclick",
"rave.layout.searchHandler.removeMemberFromPage("+this.id+", '"+this.username+"');").text(rave.getClientMessage("common.remove"))),rave.layout.searchHandler.isUserEditor(this.username)?$("#pageEditorStatusHolder"+this.id).append($("<a/>").attr("href","#").attr("id",this.id).attr("onclick","rave.layout.searchHandler.removeEditingRightsFromMember("+this.id+", '"+this.username+"');").text(rave.getClientMessage("common.remove"))):$("#pageEditorStatusHolder"+this.id).append($("<a/>").attr("href","#").attr("id",
this.id).attr("onclick","rave.layout.searchHandler.addEditingRightsToMember("+this.id+", '"+this.username+"');").text(rave.getClientMessage("common.add")))):$("#shareButtonHolder"+this.id).append($("<a/>").attr("href","#").attr("id",this.id).attr("onclick","rave.layout.searchHandler.addMemberToPage("+this.id+", '"+this.username+"');").text(rave.getClientMessage("common.add"))))})},setDefaults:function(b,c,g,e){if("undefined"==this.existingSharers||null==this.existingSharers)this.existingSharers={};
this.username=b;this.userId=c;this.pageId=g;"PENDING"==e&&a()},addExistingMember:function(a,b){if("undefined"==this.existingSharers||null==this.existingSharers)this.existingSharers={};this.existingSharers[a]=b},removeExistingMember:function(a){delete this.existingSharers[a]},isUserAlreadyAdded:function(a){for(member in this.existingSharers)if(a==member)return!0;return!1},isUserEditor:function(a){for(member in this.existingSharers)if(a==member&&!0==this.existingSharers[member])return!0;return!1},addMemberToPage:function(a,
b){confirm(rave.getClientMessage("create.share.confirm")+" ("+b+")")&&($("#shareButtonHolder"+a).hide(),rave.api.rpc.addMemberToPage({pageId:this.pageId,userId:a,successCallback:function(){rave.layout.searchHandler.addExistingMember(b);$("#shareButtonHolder"+a).empty();$("#shareButtonHolder"+a).append($("<a/>").attr("href","#").attr("id",a).attr("onclick","rave.layout.searchHandler.removeMemberFromPage("+a+", '"+b+"');").text(rave.getClientMessage("common.remove")));$("#shareButtonHolder"+a).show();
$("#pageEditorStatusHolder"+a).empty();$("#pageEditorStatusHolder"+a).append($("<a/>").attr("href","#").attr("id",a).attr("onclick","rave.layout.searchHandler.addEditingRightsToMember("+a+", '"+b+"');").text(rave.getClientMessage("common.add")));alert("("+b+") "+rave.getClientMessage("create.share"))}}))},removeMemberFromPage:function(a,b){if(a==rave.layout.searchHandler.userId?confirm(rave.getClientMessage("revoke.share.current.user.confirm")):confirm(rave.getClientMessage("revoke.share.confirm")+
" ("+b+")"))$("#shareButtonHolder"+a).hide(),rave.api.rpc.removeMemberFromPage({pageId:this.pageId,userId:a,successCallback:function(){rave.layout.searchHandler.removeExistingMember(b);$("#pageEditorStatusHolder"+a).empty();$("#shareButtonHolder"+a).empty();$("#shareButtonHolder"+a).append($("<a/>").attr("href","#").attr("id",a).attr("onclick","rave.layout.searchHandler.addMemberToPage("+a+", '"+b+"');").text(rave.getClientMessage("common.add")));$("#shareButtonHolder"+a).show();a==rave.layout.searchHandler.userId?
(alert(rave.getClientMessage("revoke.share.current.user")),document.location.href="/"):alert("("+b+") "+rave.getClientMessage("revoke.share"))}})},addEditingRightsToMember:function(a,b){confirm(rave.getClientMessage("grant.editing.user.confirm")+" ("+b+")")&&($("#pageEditorStatusHolder"+a).hide(),rave.api.rpc.updatePageEditingStatus({pageId:this.pageId,userId:a,isEditor:!0,successCallback:function(){rave.layout.searchHandler.existingSharers[b]=!0;$("#pageEditorStatusHolder"+a).empty();$("#pageEditorStatusHolder"+
a).append($("<a/>").attr("href","#").attr("id",a).attr("onclick","rave.layout.searchHandler.removeEditingRightsFromMember("+a+", '"+b+"');").text(rave.getClientMessage("common.remove")));$("#pageEditorStatusHolder"+a).show()}}))},removeEditingRightsFromMember:function(a,b){confirm(rave.getClientMessage("revoke.editing.user.confirm")+" ("+b+")")&&($("#pageEditorStatusHolder"+a).hide(),rave.api.rpc.updatePageEditingStatus({pageId:this.pageId,userId:a,isEditor:!1,successCallback:function(){rave.layout.searchHandler.existingSharers[b]=
!1;$("#pageEditorStatusHolder"+a).empty();$("#pageEditorStatusHolder"+a).append($("<a/>").attr("href","#").attr("id",a).attr("onclick","rave.layout.searchHandler.addEditingRightsToMember("+a+", '"+b+"');").text(rave.getClientMessage("common.add")));$("#pageEditorStatusHolder"+a).show()}}))},confirmPageShare:a,acceptShare:function(){$("#confirmSharePageDialog").modal("hide");rave.api.rpc.updateSharedPageStatus({pageId:rave.layout.searchHandler.pageId,shareStatus:"accepted",successCallback:function(){}})},
declineShare:function(){$("#confirmSharePageDialog").modal("hide");rave.api.rpc.updateSharedPageStatus({pageId:rave.layout.searchHandler.pageId,shareStatus:"refused",successCallback:function(){rave.api.rpc.removeMemberFromPage({pageId:rave.layout.searchHandler.pageId,userId:rave.layout.searchHandler.userId,successCallback:function(){document.location.href="/"}})}})}}}(),o=function(){var a,b,c;return{init:function(){$(".widget-menu").each(function(d,e){var k=rave.getObjectIdFromDomId(e.id);a=$("#widget-"+
k+"-menu-move-item");a.hasClass("menu-item-disabled")||a.bind("click",function(a){var b=rave.getObjectIdFromDomId(this.id);$(".dropdown").removeClass("open");$("#moveWidgetModal").data("regionWidgetId",b);$("#moveWidgetModal").modal("show");a.stopPropagation()});b=$("#widget-"+k+"-menu-delete-item");b.hasClass("menu-item-disabled")||b.bind("click",function(a){var b=rave.getObjectIdFromDomId(this.id);rave.layout.deleteRegionWidget(b);a.stopPropagation()});c=$("#widget-"+k+"-menu-maximize-item");c.hasClass("menu-item-disabled")||
c.bind("click",function(a){var b=rave.getObjectIdFromDomId(this.id);rave.maximizeWidget({data:{id:b}});a.stopPropagation()});$menuItemAbout=$("#widget-"+k+"-menu-about-item");$menuItemAbout.hasClass("menu-item-disabled")||$menuItemAbout.bind("click",function(a){var b=rave.getRegionWidgetById(rave.getObjectIdFromDomId(this.id));rave.viewWidgetDetail(b.widgetId,f());a.stopPropagation()})})},hideAll:function(){$(".widget-menu").hide()},hide:function(a){$("#widget-"+a+"-menu").hide()},show:function(a){$("#widget-"+
a+"-menu").show()},enableEditPrefsMenuItem:function(a,b){var c=$("#widget-"+a+"-menu-editprefs-item");c.removeClass("menu-item-disabled");c.bind("click",function(a){var c=rave.getObjectIdFromDomId(this.id);b?rave.editCustomPrefs({data:{id:c}}):rave.editPrefs(c);a.stopPropagation()})}}}();return{init:function(){c.init();o.init();k.init();$(".dropdown-toggle").dropdown()},getCurrentPageId:f,hideWidgetMenu:o.hide,deleteRegionWidget:function(a){confirm(rave.getClientMessage("widget.remove_confirm"))&&
rave.api.rpc.removeWidget({regionWidgetId:a,successCallback:function(){$("#widget-"+this.regionWidgetId+"-wrapper").remove();rave.removeWidgetFromMap(this.regionWidgetId);rave.isPageEmpty()&&rave.displayEmptyPageMessage()}})},enableEditPrefsMenuItem:o.enableEditPrefsMenuItem,addPage:function(){if(l.valid()){var b=e.val(),c=a.val();rave.api.rpc.addPage({pageName:b,pageLayoutCode:c,successCallback:function(a){rave.viewPage(a.result.id)}})}},updatePage:function(){l.valid()&&rave.api.rpc.updatePagePrefs({pageId:b.val(),
title:e.val(),layout:a.val(),successCallback:function(a){rave.viewPage(a.result.id)}})},movePage:function(){var a=$("#moveAfterPageId").val(),b={pageId:$("#currentPageId").val(),successCallback:function(a){rave.viewPage(a.result.id)}};-1!=a&&(b.moveAfterPageId=a);rave.api.rpc.movePage(b)},closePageDialog:function(){l[0].reset();b.val("");$("#pageMenuDialog").modal("hide")},moveWidgetToPage:function(a){var b=$("#moveToPageId").val();rave.api.rpc.moveWidgetToPage({toPageId:b,regionWidgetId:a,successCallback:function(){rave.viewPage(b)}})},
searchHandler:k}}();rave=rave||{};
rave.opensocial=rave.opensocial||function(){function f(){var a={};a[osapi.container.ServiceConfig.API_PATH]="/rpc";a[osapi.container.ContainerConfig.RENDER_DEBUG]="1";j=new osapi.container.Container(a)}function n(){j.views.createElementForGadget=function(a,b,c,e){if(e)return rave.createPopup(e)};j.views.createElementForEmbeddedExperience=function(a,b,c){if(c)return rave.createPopup(c)};j.views.createElementForUrl=function(a,b){if(b)return rave.createPopup(b)};j.views.destroyElement=function(a){var b=
a.el_;j.closeGadget(a);rave.destroyPopup(b)}}function l(a){var b=document.getElementById(["widget-",a.regionWidgetId,"-body"].join(""));a.site=j.newGadgetSite(b);a.maximize=function(a,b){e("undefined"===typeof b||null===b?rave.opensocial.VIEW_NAMES.CANVAS:b,this,a)};a.minimize=function(a,b){this.collapsed||e("undefined"===typeof b||null===b?rave.opensocial.VIEW_NAMES.HOME:b,this,a)};a.collapse=function(){$(rave.getRegionWidgetById(this.regionWidgetId).site.getActiveSiteHolder().getIframeElement()).hide()};
a.restore=function(){e(rave.opensocial.VIEW_NAMES.HOME,rave.getRegionWidgetById(this.regionWidgetId))};a.savePreferences=function(a){this.userPrefs=a;rave.isPageEditor()&&rave.api.rest.saveWidgetPreferences({regionWidgetId:this.regionWidgetId,userPrefs:a});a=rave.opensocial.getCurrentView(this.regionWidgetId);this.collapsed||e(a,this,void 0)};a.editCustomPrefs=function(){e(rave.opensocial.VIEW_NAMES.PREFERENCES,this)};a.renderView=function(a){e(a,this)};if(a.metadata.hasPrefsToEdit||a.metadata.views.preferences)void 0!=
a.metadata.views.preferences?rave.layout.enableEditPrefsMenuItem(a.regionWidgetId,!0):rave.layout.enableEditPrefsMenuItem(a.regionWidgetId,!1);a.collapsed||e(rave.opensocial.VIEW_NAMES.HOME,a,void 0)}function e(a,b,c){var e={},f=document.getElementById("widget-"+b.regionWidgetId+"-wrapper"),h=k;a==rave.opensocial.VIEW_NAMES.CANVAS?h=f.clientHeight:b.metadata.modulePrefs&&b.metadata.modulePrefs.height&&(h=b.metadata.modulePrefs.height);e[osapi.container.RenderParam.VIEW]=a;e[osapi.container.RenderParam.WIDTH]=
"100%";e[osapi.container.RenderParam.HEIGHT]=h;var a=osapi.container.RenderParam.USER_PREFS,f=b.userPrefs,h=b.metadata.userPrefs,l={},o;for(o in h){var n=h[o],A=f[n.name];l[n.name]="undefined"==typeof A?n.defaultValue:A}e[a]=l;j.navigateGadget(b.site,b.widgetUrl,c,e)}function b(a){var b=a.gs.getActiveSiteHolder().getElement().id,b="widget-"+rave.getObjectIdFromDomId(b)+"-title";if(b=document.getElementById(b))a="[object Array]"==Object.prototype.toString.call(a.a)?a.a[0]:a.a,b.innerHTML=gadgets.util.escapeString(a)}
function a(a,b,c,e){a=rave.getObjectIdFromDomId(a.gs.getActiveSiteHolder().getElement().id);rave.getRegionWidgetById(a).userPrefs[c]=e;rave.isPageEditor()&&rave.api.rest.saveWidgetPreference({regionWidgetId:a,userPref:{prefName:c,prefValue:e}})}function c(a,b,c){var a=rave.getObjectIdFromDomId(a.gs.getActiveSiteHolder().getElement().id),e={data:{}};e.data.id=a;e.data.view=b;switch(-1==b.indexOf(".")?b:b.substring(0,b.indexOf("."))){case o.CANVAS:rave.maximizeWidget(e,c);break;case o.HOME:rave.minimizeWidget(e,
c);break;case o.PREFERENCES:rave.editCustomPrefs(e)}}var k=250,o={CANVAS:"canvas",DEFAULT:"default",HOME:"home",PREFERENCES:"preferences"},j;return{TYPE:"OpenSocial",VIEW_NAMES:o,VIEW_TARGETS:{TAB:"tab",DIALOG:"dialog",MODALDIALOG:"modal_dialog",SIDEBAR:"sidebar"},init:function(){f();j.rpcRegister("set_title",b);j.rpcRegister("requestNavigateTo",c);j.rpcRegister("set_pref",a);n();gadgets.pubsub2router.init({hub:rave.getManagedHub()})},container:function(){("undefined"==typeof j||null==j)&&f();return j},
initWidget:function(a){var b="undefined"!=typeof a.metadata.error?{valid:!1,error:a.metadata.error.message}:{valid:!0};if(b.valid){b={};b[a.widgetUrl]=a.metadata;var c={};c[osapi.container.TokenResponse.TOKEN]=a.securityToken;c[osapi.container.MetadataResponse.RESPONSE_TIME_MS]=(new Date).getTime();var e={};e[a.widgetUrl]=c;c={};c[osapi.container.ContainerConfig.PRELOAD_METADATAS]=b;c[osapi.container.ContainerConfig.PRELOAD_TOKENS]=e;c[osapi.container.ContainerConfig.PRELOAD_REF_TIME]=null;j.preloadCaches(c);
l(a)}else rave.errorWidget(a.regionWidgetId,rave.getClientMessage("opensocial.render_error")+"<br /><br />"+b.error)},reset:function(){j=null},getCurrentView:function(a){a=rave.getRegionWidgetById(a).site.getActiveSiteHolder();return null==a?null:a.getView()}}}();rave.registerProvider(rave.opensocial);rave=rave||{};
rave.personprofile=rave.personprofile||function(){function f(){$(".nav-tabs a:first").tab("show");$('#personProfileSubPages a[data-toggle="tab"]').on("shown",function(){var b=$($(this).attr("href")).attr("id");!1==l[b]&&($("#"+b+" .widget-wrapper").each(function(){rave.getRegionWidgetById(rave.getObjectIdFromDomId(this.id)).restore()}),l[b]=!0)});var e=$("#personProfileSubPages .tab-pane.active")[0].id;$("#personProfileSubPages .tab-pane").each(function(){l[this.id]=this.id==e})}function n(){var e=
$("#profileEdit");e&&e.click(function(){rave.api.handler.userProfileEditHandler(!0)});(e=$("#cancelEdit"))&&e.click(function(){rave.api.handler.userProfileEditHandler(!1)})}var l={};return{init:function(){f();n()}}}();rave=rave||{};
rave.store=rave.store||function(){function f(){$(".ratingButtons").button();$(".widgetRating").each(function(){var b=$(this).find(".widgetLikeButton"),a=$(this).find(".widgetLikeCount"),c=$(this).find(".widgetDislikeButton"),e=$(this).find(".widgetDislikeCount");b.outerWidth()>=a.outerWidth()?a.css("width",b.outerWidth()+"px"):b.css("width",a.outerWidth()+"px");c.outerWidth()>=e.outerWidth()?e.css("width",c.outerWidth()+"px"):c.css("width",e.outerWidth()+"px")});$(".widgetLikeButton").click(function(){if(!$(this).hasClass("active")){var b=
this.id.substring(5);rave.api.rest.updateWidgetRating({widgetId:b,score:10});b={widgetId:b,widgetLikeButton:this,widgetDislikeButton:$("#dislike-"+b),isLike:!0};rave.api.handler.widgetRatingHandler(b);$(this).addClass("btn-success");$(this).siblings(".btn").removeClass("btn-danger")}});$(".widgetDislikeButton").click(function(){if(!$(this).hasClass("active")){var b=this.id.substring(8);rave.api.rest.updateWidgetRating({widgetId:b,score:0});b={widgetId:b,widgetLikeButton:$("#like-"+b),widgetDislikeButton:this,
isLike:!1};rave.api.handler.widgetRatingHandler(b);$(this).addClass("btn-danger");$(this).siblings(".btn").removeClass("btn-success")}})}function n(){$(".commentNewButton").button({icons:{primary:"ui-icon-disk"},text:!1}).click(function(){var b=this.id.substring(12);rave.api.rest.createWidgetComment({widgetId:b,text:$("#newComment-"+b).get(0).value,successCallback:function(){window.location.reload()}})});$(".commentDeleteButton").button({icons:{primary:"ui-icon-close"},text:!1}).click(function(){var b=
this.id.substring(15),a=this.getAttribute("data-widgetid");rave.api.rest.deleteWidgetComment({widgetId:a,commentId:b,successCallback:function(){window.location.reload()}})});$(".commentEditButton").click(function(){var b=this.id.substring(13),a=this.getAttribute("data-widgetid"),c=$(this).parents(".comment").find(".commentText").text();$("#editComment").html(c);$("#editComment-dialog #updateComment").click(function(){rave.api.rest.updateWidgetComment({widgetId:a,commentId:b,text:$("#editComment").get(0).value,
successCallback:function(){window.location.reload()}})}).html(rave.getClientMessage("common.update"))})}function l(b){null!=b&&$("#tagList").change(function(){var a=$("#tagList option:selected").text(),a=$.trim(a);1<a.length&&(document.location.href=rave.getContext()+"store/tag?keyword="+a+"&referringPageId="+b)})}function e(b){null!=b&&$("#categoryList").change(function(){var a=$("#categoryList option:selected").val(),a=parseInt(a);isNaN(a)||(document.location.href=rave.getContext()+"store/category?categoryId="+
a+"&referringPageId="+b)})}return{init:function(b){f();n();l(b);e(b)},initTags:function(b){$('*[data-toggle="basic-slide"]').click(function(){var a;$(this).attr("data-target")?(a=$(this).attr("data-target"),console.log($(this).attr("data-target"))):(a=$(this).attr("href"),console.log("else"));if($(this).attr("data-toggle-text")){var b=$(this).html();$(this).html($(this).attr("data-toggle-text"));$(this).attr("data-toggle-text",b)}$(a).slideToggle()});$(".tagNewButton").click(function(){var a=this.id.substring(8);
rave.api.rest.createWidgetTag({widgetId:a,text:$("#tags").get(0).value,successCallback:function(){window.location.reload()}})});rave.api.rest.getTags({widgetId:b,successCallback:function(a){a=$.map(a,function(a){return{label:a.keyword,value:a.keyword}});$("#tags").typeahead({source:a})}})}}}();rave=rave||{};
rave.wookie=rave.wookie||function(){function f(){}function n(){}function l(){}return{TYPE:"W3C",init:function(){},initWidget:function(e){var b=document.getElementById(["widget-",e.regionWidgetId,"-body"].join("")),a=250;e.height&&(a=e.height);window["onWidget"+e.regionWidgetId+"Load"]=function(){window.document.getElementById(e.regionWidgetId).style.visibility="visible"};var c=new OpenAjax.hub.IframeContainer(rave.getManagedHub(),""+e.regionWidgetId,{Container:{onSecurityAlert:f,onConnect:n,onDisconnect:l},
IframeContainer:{parent:b,iframeAttrs:{style:{width:"100%"},vspace:0,hspace:0,marginheight:0,marginwidth:0,scroll:"no",frameborder:0,height:a,"min-height":"250px"},uri:e.widgetUrl,onGadgetLoad:"onWidget"+e.regionWidgetId+"Load"}});e.collapse=function(){$(c.getIframe).hide()};e.restore=function(){$(c.getIframe).show()};e.maximize=function(){e.collapsed&&$(c.getIframe).show()};e.minimize=function(){e.collapsed&&$(c.getIframe).hide()};e.collapsed&&$(c.getIframe).hide()}}}();rave.registerProvider(rave.wookie);